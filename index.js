function import$(t,r){var o={}.hasOwnProperty;for(var e in r)o.call(r,e)&&(t[e]=r[e]);return t}$(document).ready(function(){var t,r,o,e,s,h,i,n;return t=document,r="http://www.w3.org/2000/svg",Node.prototype.attr=function(t){var r,o,e=this;return"string"==typeof t?this.getAttribute(t):(function(){var e,s=[];for(r in e=t)o=e[r],s.push([r,o]);return s}().map(function(t){var r,o;return r=t[0],o=t[1],e.setAttribute(r,o)}),this)},o=t.getElementById("svg"),e={target:null,down:function(t){var r;return this.target=t.target,r={sx:t.clientX,sy:t.clientY},this.sx=r.sx,this.sy=r.sy,r},move:function(t){var r,o,e,s,h,i,a,c,p,l,u,d;if(!t.buttons)return this.target=null;if(r={cx:t.clientX,cy:t.clientY},o=r.cx,e=r.cy,this.target){if(r={owner:(r=this.target).owner,type:r.type,idx:r.idx},s=r.owner,h=r.type,i=r.idx,!s)return;if(a=s.root.getBoundingClientRect(),r=[o-a.left,e-a.top],o=r[0],e=r[1],h===n.BOXPTR)return a=s.box,r=[i%2,+(i>1)],c=r[0],p=r[1],a[c][0]=!c&&a[1][0]>o||c&&a[0][0]<o?o:a[+!c][0]+2*c-1,a[p][1]=!p&&a[1][1]>e||p&&a[0][1]<e?e:a[+!p][1]+2*p-1,s.resizePts(),s.update();if(h===n.POINT)return r=[s.pts,s.box],l=r[0],a=r[1],l[i].anchor[0]=o,l[i].anchor[1]=e,s.resizeBox(),s.update();if(h===n.CTRL)return u=s.pts[i].anchor,d=s.pts[i][this.target.ctrl],d[0]=o-u[0],d[1]=e-u[1],s.update()}},up:function(){var t;return this.target&&this.target.owner&&this.target.type===n.POINT&&((t=this.target.owner.active)&&(t.active=!1),this.target.active=!0,this.target.owner.active=this.target,this.target.owner.update()),this.target=null}},s={mousedown:e.down,mousemove:e.move,mouseup:e.up},function(){var t,r=[];for(h in t=s)i=t[h],r.push([h,i]);return r}().map(function(t){var r,e;return r=t[0],e=t[1],o.addEventListener(r,e)}),n=function(o){var e,s,h,i,a,c,p,l,u,d,m,x,f,g=this;for(this.root=o,e=o.getBoundingClientRect(),import$(this,{box:[[.2*e.width,.2*e.height],[.8*e.width,.8*e.height]],pts:[{ctrl1:[0,0],ctrl2:[0,0],anchor:[0,0]}],dom:{pts:[],ctrl1:{line:[],pts:[]},ctrl2:{line:[],pts:[]}}}),s=this.dom.path=t.createElementNS(r,"path"),s.attr({"class":"pts-path"}),o.appendChild(this.dom.path),this.dom.box=t.createElementNS(r,"rect"),this.dom.box.attr({"class":"box"}),o.appendChild(this.dom.box),this.dom.boxptr=function(){var o,e=[];for(o=0;4>o;++o)h=o,e.push(t.createElementNS(r,"circle"));return e}(),this.dom.boxptr.map(function(t,r){var e,s,h;return e=[g.box[r%2][0],g.box[+(r>1)][1]],s=e[0],h=e[1],t.attr({r:4,"class":"box-ptr"}),t.owner=g,t.type=n.BOXPTR,t.idx=r,o.appendChild(t)}),i=.6,a=[],c=0;0>i?c>6.28:6.28>c;c+=i)p=c,l=200+100*Math.cos(p),u=200+100*Math.sin(p),d=200+100*Math.cos(p-i/3)-l,m=200+100*Math.sin(p-i/3)-u,x=200+100*Math.cos(p+i/3)-l,f=200+100*Math.sin(p+i/3)-u,a.push({ctrl1:[d,m],ctrl2:[x,f],anchor:[l,u]});return this.pts=a,this.update(),this.curpercent=0,setInterval(function(){var t;if(g.dom.path)return g.curpercent<1?(t=g.pathlen*g.curpercent,g.dom.path.attr({"stroke-dasharray":t+" "+(g.pathlen-t)})):(t=g.pathlen*(g.curpercent-1),g.dom.path.attr({"stroke-dasharray":"0 "+t+" "+(g.pathlen-t)})),g.curpercent+=.05,g.curpercent>=2?g.curpercent=0:void 0},100),this},import$(n.prototype,{resizeBox:function(t){var r,o,e,s,h=[];for(null==t&&(t=this.box),this.pts.length&&(t[0][0]=t[1][0]=this.pts[0].anchor[0],t[0][1]=t[1][1]=this.pts[0].anchor[1]),r=0,e=(o=this.pts).length;e>r;++r)s=o[r],s.anchor[0]>t[1][0]&&(t[1][0]=s.anchor[0]),s.anchor[0]<t[0][0]&&(t[0][0]=s.anchor[0]),s.anchor[1]>t[1][1]&&(t[1][1]=s.anchor[1]),s.anchor[1]<t[0][1]&&h.push(t[0][1]=s.anchor[1]);return h},resizePts:function(){var t,r,o,e,s,h,i,n=[];for(t=[[0,0],[0,0]],this.resizeBox(t),r=(this.box[1][0]-this.box[0][0])/(t[1][0]-t[0][0]),o=(this.box[1][1]-this.box[0][1])/(t[1][1]-t[0][1]),e=0,h=(s=this.pts).length;h>e;++e)i=s[e],i.ctrl1[0]*=r,i.ctrl1[1]*=o,i.ctrl2[0]*=r,i.ctrl2[1]*=o,i.anchor[0]=(i.anchor[0]-t[0][0])*r+this.box[0][0],n.push(i.anchor[1]=(i.anchor[1]-t[0][1])*o+this.box[0][1]);return n},update:function(){function o(t,r){var o,e,s,h,i;return o=m.pts[r].anchor,e=o[0],s=o[1],o=m.pts[r][u],h=o[0],i=o[1],t.attr({cx:e+h,cy:s+i})}function e(t,r){var o,e,s,h,i;return o=m.pts[r].anchor,e=o[0],s=o[1],o=m.pts[r][u],h=o[0],i=o[1],t.attr({x1:e,y1:s,x2:e+h,y2:s+i})}var s,h,i,a,c,p,l,u,d,m=this;if(s=this.dom.pts.length-this.pts.length)if(s>0)for(h=this.dom.pts.length+1,i=this.pts.length;h>=i;--h)a=h,this.root.removeChild(this.dom.pts.pop()),this.root.removeChild(this.dom.ctrl1.line.pop()),this.root.removeChild(this.dom.ctrl1.pts.pop()),this.root.removeChild(this.dom.ctrl2.line.pop()),this.root.removeChild(this.dom.ctrl2.pts.pop());else for(h=this.dom.pts.length,i=this.pts.length;i>h;++h){for(a=h,c=0,l=(p=["ctrl1","ctrl2"]).length;l>c;++c)u=p[c],d=t.createElementNS(r,"line"),d.attr({x1:this.pts[a].anchor[0],y1:this.pts[a].anchor[1],x2:this.pts[a].anchor[0]+this.pts[a][u][0],y2:this.pts[a].anchor[1]+this.pts[a][u][1],"class":"pts-ctrl-line"}),this.dom[u].line.push(d),this.root.appendChild(d),d=t.createElementNS(r,"circle"),d.attr({cx:this.pts[a].anchor[0]+this.pts[a][u][0],cy:this.pts[a].anchor[1]+this.pts[a][u][1],r:3,"class":"pts-ctrl-ptr"}),d.owner=this,d.type=n.CTRL,d.idx=a,d.ctrl=u,this.dom[u].pts.push(d),this.root.appendChild(d);d=t.createElementNS(r,"circle"),d.attr({cx:this.pts[a].anchor[0],cy:this.pts[a].anchor[1],r:5,"class":"pts-ptr"}),d.owner=this,d.type=n.POINT,d.idx=a,this.dom.pts.push(d),this.root.appendChild(d)}for(this.dom.pts.map(function(t,r){var o,e,s;return o=m.pts[r].anchor,e=o[0],s=o[1],t.attr({cx:e,cy:s}),t.style.fill=t.active?"#f00":"#fff",t.idx=r}),h=0,l=(p=["ctrl1","ctrl2"]).length;l>h;++h)u=p[h],this.dom[u].pts.map(o),this.dom[u].line.map(e);return this.dom.box.attr({x:this.box[0][0],y:this.box[0][1],width:this.box[1][0]-this.box[0][0],height:this.box[1][1]-this.box[0][1]}),this.dom.boxptr.map(function(t,r){var o,e,s;return o=[m.box[r%2][0],m.box[+(r>1)][1]],e=o[0],s=o[1],t.attr({cx:e,cy:s})}),this.dom.path.attr({d:n.fromPoints(this.pts)}),this.pathlen=this.dom.path.getTotalLength()}}),import$(n,{POINT:1,CTRL:2,BOXPTR:3,fromPoints:function(t,r){var o,e,s,h,i,n,a,c,p,l;for(null==r&&(r=!1),o="M"+t[0].anchor[0]+" "+t[0].anchor[1],e=t[0],r&&(t=t.concat([t[0]])),s=1,h=t.length;h>s;++s)i=s,n=t[i],a=e.anchor[0]+e.ctrl2[0],c=e.anchor[1]+e.ctrl2[1],p=n.anchor[0]+n.ctrl1[0],l=n.anchor[1]+n.ctrl1[1],o+="C"+a+" "+c+" "+p+" "+l+" "+n.anchor[0]+" "+n.anchor[1],e=n;return o}}),new n(o)});