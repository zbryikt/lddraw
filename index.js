function import$(t,r){var e={}.hasOwnProperty;for(var s in r)e.call(r,s)&&(t[s]=r[s]);return t}$(document).ready(function(){var t,r,e,s,o;return t=document,r="http://www.w3.org/2000/svg",Node.prototype.attr=function(t){var r,e,s=this;return"string"==typeof t?this.getAttribute(t):(function(){var s,o=[];for(r in s=t)e=s[r],o.push([r,e]);return o}().map(function(t){var r,e;return r=t[0],e=t[1],s.setAttribute(r,e)}),this)},e=t.getElementById("svg"),s=function(e){var o,i,h,n,a=this;return e||(this.root=e=t.createElementNS(r,"svg"),e.attr({width:"400px",height:"400px",viewport:"0 0 400 400",preserveAspectRatio:"xMidYMid","class":"lddraw simple"})),e.owner=this,o=e.getBoundingClientRect(),import$(this,{box:[[.2*o.width,.2*o.height],[.8*o.width,.8*o.height]],pts:[],dom:{pts:[],ctrl1:{line:[],pts:[]},ctrl2:{line:[],pts:[]}}}),i=this.dom.path=t.createElementNS(r,"path"),i.attr({"class":"pts-path"}),e.appendChild(this.dom.path),this.dom.box=t.createElementNS(r,"rect"),this.dom.box.attr({"class":"box"}),e.appendChild(this.dom.box),this.dom.boxptr=function(){var e,s=[];for(e=0;4>e;++e)h=e,s.push(t.createElementNS(r,"circle"));return s}(),this.dom.boxptr.map(function(t,r){var o,i,h;return o=[a.box[r%2][0],a.box[+(r>1)][1]],i=o[0],h=o[1],t.attr({r:4,"class":"box-ptr"}),t.owner=a,t.type=s.BOXPTR,t.idx=r,e.appendChild(t)}),n=.6,this.update(),this.curpercent=0,setInterval(function(){},100),e.addEventListener("mousedown",this.mouse.down),e.addEventListener("mousemove",this.mouse.move),e.addEventListener("mouseup",this.mouse.up),this},import$(s.prototype,{resizeBox:function(t){var r,e,s,o,i=[];for(null==t&&(t=this.box),this.pts.length&&(t[0][0]=t[1][0]=this.pts[0].anchor[0],t[0][1]=t[1][1]=this.pts[0].anchor[1]),r=0,s=(e=this.pts).length;s>r;++r)o=e[r],o.anchor[0]>t[1][0]&&(t[1][0]=o.anchor[0]),o.anchor[0]<t[0][0]&&(t[0][0]=o.anchor[0]),o.anchor[1]>t[1][1]&&(t[1][1]=o.anchor[1]),o.anchor[1]<t[0][1]&&i.push(t[0][1]=o.anchor[1]);return i},resizePts:function(){var t,r,e,s,o,i,h,n=[];for(t=[[0,0],[0,0]],this.resizeBox(t),r=(this.box[1][0]-this.box[0][0])/(t[1][0]-t[0][0]),e=(this.box[1][1]-this.box[0][1])/(t[1][1]-t[0][1]),s=0,i=(o=this.pts).length;i>s;++s)h=o[s],h.ctrl1[0]*=r,h.ctrl1[1]*=e,h.ctrl2[0]*=r,h.ctrl2[1]*=e,h.anchor[0]=(h.anchor[0]-t[0][0])*r+this.box[0][0],n.push(h.anchor[1]=(h.anchor[1]-t[0][1])*e+this.box[0][1]);return n},reset:function(){return this.pts=[],this.resizeBox(),this.update()},update:function(){function e(t,r){var e,s,o,i,h;return e=m.pts[r].anchor,s=e[0],o=e[1],e=m.pts[r][d],i=e[0],h=e[1],t.attr({cx:s+i,cy:o+h})}function o(t,r){var e,s,o,i,h;return e=m.pts[r].anchor,s=e[0],o=e[1],e=m.pts[r][d],i=e[0],h=e[1],t.attr({x1:s,y1:o,x2:s+i,y2:o+h})}var i,h,n,a,c,p,l,d,u,m=this;if(i=this.dom.pts.length-this.pts.length)if(i>0)for(h=this.dom.pts.length,n=this.pts.length;h>n;--h)a=h,this.root.removeChild(this.dom.pts.pop()),this.root.removeChild(this.dom.ctrl1.line.pop()),this.root.removeChild(this.dom.ctrl1.pts.pop()),this.root.removeChild(this.dom.ctrl2.line.pop()),this.root.removeChild(this.dom.ctrl2.pts.pop());else for(h=this.dom.pts.length,n=this.pts.length;n>h;++h){for(a=h,c=0,l=(p=["ctrl1","ctrl2"]).length;l>c;++c)d=p[c],u=t.createElementNS(r,"line"),u.attr({x1:this.pts[a].anchor[0],y1:this.pts[a].anchor[1],x2:this.pts[a].anchor[0]+this.pts[a][d][0],y2:this.pts[a].anchor[1]+this.pts[a][d][1],"class":"pts-ctrl-line"}),this.dom[d].line.push(u),this.root.appendChild(u),u=t.createElementNS(r,"circle"),u.attr({cx:this.pts[a].anchor[0]+this.pts[a][d][0],cy:this.pts[a].anchor[1]+this.pts[a][d][1],r:3,"class":"pts-ctrl-ptr"}),u.owner=this,u.type=s.CTRL,u.idx=a,u.ctrl=d,this.dom[d].pts.push(u),this.root.appendChild(u);u=t.createElementNS(r,"circle"),u.attr({cx:this.pts[a].anchor[0],cy:this.pts[a].anchor[1],r:5,"class":"pts-ptr"}),u.owner=this,u.type=s.POINT,u.idx=a,this.dom.pts.push(u),this.root.appendChild(u)}for(this.dom.pts.map(function(t,r){var e,s,o;return e=m.pts[r].anchor,s=e[0],o=e[1],t.attr({cx:s,cy:o}),t.style.fill=t.active?"#f00":"#fff",t.idx=r}),h=0,l=(p=["ctrl1","ctrl2"]).length;l>h;++h)d=p[h],this.dom[d].pts.map(e),this.dom[d].line.map(o);return this.dom.box.attr({x:this.box[0][0],y:this.box[0][1],width:this.box[1][0]-this.box[0][0],height:this.box[1][1]-this.box[0][1]}),this.dom.boxptr.map(function(t,r){var e,s,o;return e=[m.box[r%2][0],m.box[+(r>1)][1]],s=e[0],o=e[1],t.attr({cx:s,cy:o})}),this.dom.path.attr({d:s.fromPoints(this.pts)}),this.pathlen=this.dom.path.getTotalLength()},mouse:{target:null,down:function(t){var r;return this.target=t.target,r={sx:t.clientX,sy:t.clientY},this.sx=r.sx,this.sy=r.sy,r},move:function(t){var r,e,o,i,h,n,a,c,p,l,d,u,m;if(!t.buttons)return this.target=null;if(r={cx:t.clientX,cy:t.clientY},e=r.cx,o=r.cy,this.target){if(r={owner:(r=this.target).owner,type:r.type,idx:r.idx},i=r.owner,h=r.type,n=r.idx,!i)return;if(a=i.root.getBoundingClientRect(),r=[e-a.left,o-a.top],e=r[0],o=r[1],h===s.BOXPTR)return a=i.box,r=[n%2,+(n>1)],c=r[0],p=r[1],a[c][0]=!c&&a[1][0]>e||c&&a[0][0]<e?e:a[+!c][0]+2*c-1,a[p][1]=!p&&a[1][1]>o||p&&a[0][1]<o?o:a[+!p][1]+2*p-1,i.resizePts(),i.update();if(h===s.POINT)return r=[i.pts,i.box],l=r[0],a=r[1],l[n].anchor[0]=e,l[n].anchor[1]=o,i.resizeBox(),i.update();if(h===s.CTRL)return d=i.pts[n].anchor,u=i.pts[n][this.target.ctrl],u[0]=e-d[0],u[1]=o-d[1],i.update();if("svg"===this.target.nodeName.toLowerCase()&&(i.pts.length>0&&(m=(r=i.pts)[r.length-1].anchor),0===i.pts.length||Math.pow(e-m[0],2)+Math.pow(o-m[1],2)>300))return i.pts.push({ctrl1:[0,0],ctrl2:[0,0],anchor:[e,o]}),i.resizeBox(),i.update()}},up:function(){var t,r,e,o,i;if(this.target&&this.target.owner&&this.target.type===s.POINT&&((t=this.target.owner.active)&&(t.active=!1),this.target.active=!0,this.target.owner.active=this.target,this.target.owner.update()),this.target&&this.target.owner&&"svg"===this.target.nodeName.toLowerCase()){for(r=this.target.owner.pts,spline.addCtrls(r),e=0,o=r.length;o>e;++e)i=r[e],i.ctrl1[0]-=i.anchor[0],i.ctrl1[1]-=i.anchor[1],i.ctrl2[0]-=i.anchor[0],i.ctrl2[1]-=i.anchor[1];this.target.owner.update()}return this.target=null}}}),import$(s,{POINT:1,CTRL:2,BOXPTR:3,fromPoints:function(t,r){var e,s,o,i,h,n,a,c,p,l;if(null==r&&(r=!1),!t||!t.length)return"";for(e="M"+t[0].anchor[0]+" "+t[0].anchor[1],s=t[0],r&&(t=t.concat([t[0]])),o=1,i=t.length;i>o;++o)h=o,n=t[h],a=s.anchor[0]+s.ctrl2[0],c=s.anchor[1]+s.ctrl2[1],p=n.anchor[0]+n.ctrl1[0],l=n.anchor[1]+n.ctrl1[1],e+="C"+a+" "+c+" "+p+" "+l+" "+n.anchor[0]+" "+n.anchor[1],s=n;return e}}),o=new s,$("#root")[0].appendChild(o.root)});